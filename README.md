# 📚 "〇〇歳からの" 書籍年齢分布マップ

国立国会図書館のデータから、対象年齢が明記された書籍を可視化するStreamlitアプリケーションです。

## 📖 プロジェクトの概要

このプロジェクトは、国立国会図書館のAPIから「〇〇歳からの」というパターンを含む書籍データを収集し、年齢別の分布を可視化するシステムです。データ収集から可視化、さらにはAIを使った考察記事の自動生成まで一貫して行えます。

## 📁 ファイル構成と説明

### `book_data_collect.ipynb` - データ収集スクリプト

**役割：** 国立国会図書館APIから書籍データを収集し、Googleスプレッドシートに保存するJupyter Notebookです。

**主な機能：**

1. **書籍データの収集**
   - 国立国会図書館のOpenSearch APIを使用
   - 「〇〇歳の」と「〇〇歳からの」というパターンで検索
   - 0歳から100歳までの年齢範囲で網羅的に収集

2. **データの処理**
   - **年齢抽出機能：** タイトルから年齢を抽出（数字・漢数字の両方に対応）
     - 例：「13歳からの」「十三歳からの」→ 13歳として抽出
   - **ジャンル分類機能：** タイトルのキーワードからジャンルを自動分類
     - 自己啓発・心理学、教育・学習、仕事・ビジネス、健康・スポーツなど17種類のジャンルに対応
   - **重複排除：** タイトルベースで重複を自動排除

3. **Googleスプレッドシートへの保存**
   - GCPサービスアカウントを使用してGoogleスプレッドシートに接続
   - 収集したデータを「タイトル」「発行日」「作成者」「主題」「ジャンル」の形式で保存
   - 既存データとの重複チェックを行い、新しいデータのみを追加

**使用方法：**
1. Jupyter Notebookを開く
2. `AGE_START`、`AGE_END`、`SPREADSHEET_NAME`、`JSON_FILE`などの設定を確認・変更
3. セルを実行してデータ収集を開始

**出力：**
- Googleスプレッドシート「bookdata」に書籍データが保存される
- 収集状況がリアルタイムで表示される（進捗、取得件数など）

### `app.py` - Streamlit可視化アプリケーション

**役割：** スプレッドシートに保存された書籍データを読み込み、インタラクティブな可視化とAIによる考察記事生成を行うWebアプリケーションです。

**主な機能：**

1. **データの可視化**
   - **年齢別書籍数分布ヒストグラム：** Altairを使用した美しい棒グラフで年齢ごとの書籍数を表示
   - **年代×対象年齢別クロス集計：** 発行年代と対象年齢の関係を積み上げバーチャートで可視化
   - **統計情報の表示：** 総書籍数、平均対象年齢、最小/最大年齢、中央値などを表示

2. **AIによる考察記事の自動生成**
   - Google Gemini APIを使用した考察記事の自動生成
   - **書き方スタイルの選択：** 以下の5種類から選択可能
     - 標準的：客観的で読みやすい標準的な文体
     - 評論的：批判的かつ分析的な視点
     - 詩的：比喩やイメージを多用した文学的表現
     - 学術的：学術論文のような専門的な分析
     - 親しみやすい：読者に語りかけるような口調
   - **ユーザー入力の反映：** データを見て気づいた点を入力すると、考察記事に反映される
   - 800-1000文字程度の詳細な考察記事を生成

3. **データの読み込みとキャッシュ**
   - Googleスプレッドシートからデータを読み込み
   - Streamlit Secrets（クラウド環境）またはローカルのJSONファイルで認証
   - 10分間のキャッシュ機能により、パフォーマンスを最適化

**使用方法：**
1. 必要な依存パッケージをインストール（`requirements.txt`を参照）
2. `.streamlit/secrets.toml`に認証情報を設定
3. `streamlit run app.py`でアプリケーションを起動
4. ブラウザで表示されたURLにアクセス

**UI構成：**
- **データ可視化タブ：** 年齢分布グラフと年代×年齢クロス集計グラフを表示
- **考察記事タブ：** サイドバーで記事生成設定を行い、生成された記事を表示
- **サイドバー：** 書き方スタイルの選択と、気づき・観察点の入力フィールド

## 🔄 データフロー

```
国立国会図書館API
    ↓
book_data_collect.ipynb（データ収集）
    ↓
Googleスプレッドシート（データ保存）
    ↓
app.py（データ可視化・考察記事生成）
    ↓
Webアプリケーション（ユーザーへの表示）
```

## 📋 技術スタック

- **データ収集：** Python、requests、xml.etree.ElementTree、gspread
- **可視化：** Streamlit、Altair、Pandas
- **AI：** Google Gemini API（google-generativeai）
- **データ保存：** Googleスプレッドシート（gspread）
- **認証：** GCPサービスアカウント（oauth2client）

